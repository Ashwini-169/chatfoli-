# System Architecture - OpenRouter Integration

## ğŸ—ï¸ Complete System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RESUME BUILDER APPLICATION                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            FRONTEND (React/Next.js)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Resume Builder Page                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚     AI Chatbox (Left Panel)      â”‚   Resume (Right)     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                  â”‚   Preview            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Chat Header Controls     â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”‚   â”‚  â”‚ Profile Name   â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â”‚Mode â”‚ â”‚Modelâ”‚ â”‚OR? â”‚ â”‚   â”‚  â”‚ Email, Phone   â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â”‚   â”‚  â”‚ ...            â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ [Save] [Clear] [ClearAll]â”‚  â”‚  â”‚ Resume Preview â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                          â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                  â”‚  Updates from Chat â†‘ â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Messages Container       â”‚   â”‚  Redux Store        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ (auto-scrolls)           â”‚   â”‚  â”œâ”€ Resume Data     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                          â”‚   â”‚  â”‚  â”œâ”€ Profile      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ You: I worked at Google  â”‚   â”‚  â”‚  â”œâ”€ Experience   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ AI: Great! Tell me more  â”‚   â”‚  â”‚  â”œâ”€ Education    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ You: For 3 years         â”‚   â”‚  â”‚  â”œâ”€ Skills       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ AI: What was your title? â”‚   â”‚  â”‚  â””â”€ Projects     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                          â”‚   â”‚  â””â”€ Settings        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                  â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Message Input            â”‚   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ [Type message...] [Send] â”‚   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  State Management:                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ Chat State (useState):                                   â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ messages: Message[]                                   â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ userInput: string                                     â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ selectedModel: string                                 â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ useOpenRouter: boolean                                â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ isLoading: boolean                                    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ messagesContainerRef: RefObject                       â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€ localStorage Persistence:                                â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ CHAT_LS_KEY: "chatfolio-ai-chat-v1"                  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ RESUME_LS_KEY: "chatfolio-resume-v1"                 â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Auto-save on change (useEffect)                       â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚  â””â”€ Redux State:                                             â”‚   â”‚
â”‚  â”‚     â”œâ”€ Resume Data (from Redux store)                        â”‚   â”‚
â”‚  â”‚     â”œâ”€ Updated by AI extracted data                          â”‚   â”‚
â”‚  â”‚     â””â”€ Reset to initial on Clear All                         â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  AI Models Array (5 Options):                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Gemini Pro (Google)        â†’ /api/chat                   â”‚  â”‚
â”‚  â”‚ 2. Gemini Ultra (Google)      â†’ /api/chat                   â”‚  â”‚
â”‚  â”‚ 3. GPT-4o Mini (OpenRouter)   â†’ /api/openrouter             â”‚  â”‚
â”‚  â”‚ 4. GPT-4o (OpenRouter)        â†’ /api/openrouter             â”‚  â”‚
â”‚  â”‚ 5. GPT-OSS 20B (Free)  â˜… NEW  â†’ /api/openrouter             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â†“â†“â†“
                        Request Routing Logic

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ROUTING DECISION LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  Input: selectedModel = "openai/gpt-oss-20b:free"                        â”‚
â”‚                                                                           â”‚
â”‚  Check: Does model start with "openai/" OR useOpenRouter = true?         â”‚
â”‚         YES â†“                                                             â”‚
â”‚                                                                           â”‚
â”‚  Route to: /api/openrouter                                               â”‚
â”‚                                                                           â”‚
â”‚  Request Format:                                                         â”‚
â”‚  {                                                                       â”‚
â”‚    "messages": [                                                         â”‚
â”‚      {role: "user", content: "I worked at Google"},                      â”‚
â”‚      {role: "assistant", content: "Great! Tell me..."}                   â”‚
â”‚    ],                                                                    â”‚
â”‚    "model": "openai/gpt-oss-20b:free",                                   â”‚
â”‚    "site_url": "https://openresume.app",                                 â”‚
â”‚    "site_title": "OpenResume - AI Resume Builder"                        â”‚
â”‚  }                                                                       â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              OR (if Gemini model selected)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GEMINI ROUTING PATH                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  Input: selectedModel = "gemini-pro"                                     â”‚
â”‚                                                                           â”‚
â”‚  Check: Does model start with "openai/" OR useOpenRouter = true?         â”‚
â”‚         NO â†“                                                              â”‚
â”‚                                                                           â”‚
â”‚  Route to: /api/chat                                                     â”‚
â”‚                                                                           â”‚
â”‚  Request Format:                                                         â”‚
â”‚  {                                                                       â”‚
â”‚    "conversationHistory": [...],                                         â”‚
â”‚    "userMessage": "I worked at Google",                                  â”‚
â”‚    "role": "general",                                                    â”‚
â”‚    "model": "gemini-pro",                                                â”‚
â”‚    "useOpenRouter": false                                                â”‚
â”‚  }                                                                       â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â†“â†“â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND (FastAPI/Python)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    /api/openrouter Endpoint                      â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  1. Receive request                                              â”‚   â”‚
â”‚  â”‚  2. Extract: messages, model, site_url, site_title              â”‚   â”‚
â”‚  â”‚  3. Call OpenAIRTClient.send_message()                           â”‚   â”‚
â”‚  â”‚  4. OpenAIRTClient:                                              â”‚   â”‚
â”‚  â”‚     - Sends to OpenRouter API                                    â”‚   â”‚
â”‚  â”‚     - Routes to: openai/gpt-oss-20b:free                        â”‚   â”‚
â”‚  â”‚     - Extracts JSON from response                                â”‚   â”‚
â”‚  â”‚     - Returns: (assistant_text, structured_json)                 â”‚   â”‚
â”‚  â”‚  5. Return response:                                             â”‚   â”‚
â”‚  â”‚     {                                                            â”‚   â”‚
â”‚  â”‚       "assistantMessage": "Great! How long were you there?",     â”‚   â”‚
â”‚  â”‚       "resumeData": {                                            â”‚   â”‚
â”‚  â”‚         "extractedData": {                                       â”‚   â”‚
â”‚  â”‚           "section": "workExperience",                           â”‚   â”‚
â”‚  â”‚           "fields": {...}                                       â”‚   â”‚
â”‚  â”‚         }                                                        â”‚   â”‚
â”‚  â”‚       }                                                          â”‚   â”‚
â”‚  â”‚     }                                                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚              OR                                                           â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    /api/chat Endpoint                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  1. Receive request                                              â”‚   â”‚
â”‚  â”‚  2. Extract: conversationHistory, userMessage, role, model       â”‚   â”‚
â”‚  â”‚  3. Call GeminiClient.send_message()                             â”‚   â”‚
â”‚  â”‚  4. GeminiClient:                                                â”‚   â”‚
â”‚  â”‚     - Sends to Google Gemini API                                 â”‚   â”‚
â”‚  â”‚     - Uses: gemini-pro or gemini-ultra model                     â”‚   â”‚
â”‚  â”‚     - Extracts JSON from response                                â”‚   â”‚
â”‚  â”‚     - Returns: (assistant_message, resume_data)                  â”‚   â”‚
â”‚  â”‚  5. Return response:                                             â”‚   â”‚
â”‚  â”‚     {                                                            â”‚   â”‚
â”‚  â”‚       "assistantMessage": "...",                                 â”‚   â”‚
â”‚  â”‚       "resumeData": {...}                                        â”‚   â”‚
â”‚  â”‚     }                                                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  External API Calls:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚   OpenRouter â”‚           â”‚ Google Geminiâ”‚                            â”‚
â”‚  â”‚   API        â”‚           â”‚ API          â”‚                            â”‚
â”‚  â”‚              â”‚           â”‚              â”‚                            â”‚
â”‚  â”‚ gpt-oss-20b  â”‚           â”‚ gemini-pro   â”‚                            â”‚
â”‚  â”‚ gpt-4o       â”‚           â”‚ gemini-ultra â”‚                            â”‚
â”‚  â”‚ gpt-4o-mini  â”‚           â”‚              â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â†“â†“â†“
                        Response Back to Frontend

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND RESPONSE HANDLING                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  1. Receive Response:                                                    â”‚
â”‚     {                                                                   â”‚
â”‚       "assistantMessage": "That's great experience!",                    â”‚
â”‚       "resumeData": {                                                    â”‚
â”‚         "extractedData": {                                               â”‚
â”‚           "section": "workExperience",                                   â”‚
â”‚           "fields": {                                                    â”‚
â”‚             "company": "Google",                                         â”‚
â”‚             "jobTitle": "Software Engineer",                             â”‚
â”‚             "date": "2020-2023"                                          â”‚
â”‚           }                                                              â”‚
â”‚         }                                                                â”‚
â”‚       }                                                                  â”‚
â”‚     }                                                                   â”‚
â”‚                                                                           â”‚
â”‚  2. Add to Messages:                                                     â”‚
â”‚     setMessages(prev => [...prev, {                                      â”‚
â”‚       role: 'assistant',                                                 â”‚
â”‚       content: 'That\'s great experience!'                               â”‚
â”‚     }])                                                                  â”‚
â”‚                                                                           â”‚
â”‚  3. Auto-Scroll:                                                         â”‚
â”‚     messagesContainerRef.current.scrollTop =                             â”‚
â”‚       messagesContainerRef.current.scrollHeight                          â”‚
â”‚                                                                           â”‚
â”‚  4. Extract & Dispatch Resume Data:                                      â”‚
â”‚     dispatch(changeWorkExperiences({                                     â”‚
â”‚       idx: 0,                                                            â”‚
â”‚       field: 'company',                                                  â”‚
â”‚       value: 'Google'                                                    â”‚
â”‚     }))                                                                  â”‚
â”‚                                                                           â”‚
â”‚  5. Persist to localStorage:                                             â”‚
â”‚     localStorage.setItem(CHAT_LS_KEY, JSON.stringify(messages))          â”‚
â”‚     localStorage.setItem(RESUME_LS_KEY, JSON.stringify(resume))          â”‚
â”‚                                                                           â”‚
â”‚  6. Update Redux Store:                                                  â”‚
â”‚     Resume state updated                                                 â”‚
â”‚     Form fields auto-fill with extracted data                            â”‚
â”‚     Resume preview updates                                               â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â†“â†“â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLEAR ALL RESET FLOW                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  User Clicks "Clear All" Button                                          â”‚
â”‚                    â†“                                                      â”‚
â”‚  Confirmation Dialog: "Clear ALL data including resume?"                 â”‚
â”‚                    â†“                                                      â”‚
â”‚  If User Confirms:                                                       â”‚
â”‚    1. setMessages([])                                                    â”‚
â”‚    2. localStorage.removeItem(CHAT_LS_KEY)                               â”‚
â”‚    3. localStorage.removeItem(RESUME_LS_KEY)                             â”‚
â”‚    4. dispatch(setResume(initialResumeState))                            â”‚
â”‚    5. alert("All data cleared!")                                         â”‚
â”‚                    â†“                                                      â”‚
â”‚  Result:                                                                 â”‚
â”‚    âœ“ Chat messages gone                                                  â”‚
â”‚    âœ“ Resume form completely empty                                        â”‚
â”‚    âœ“ All localStorage data cleared                                       â”‚
â”‚    âœ“ Redux store reset to initial state                                  â”‚
â”‚    âœ“ User can start fresh                                                â”‚
â”‚                    â†“                                                      â”‚
â”‚  Even After Page Reload:                                                 â”‚
â”‚    âœ“ Chat still gone (localStorage cleared)                              â”‚
â”‚    âœ“ Form still empty (Redux initialized with no data)                   â”‚
â”‚    âœ“ Completely fresh start                                              â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Resume Builder Page (TSX)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”œâ”€â†’ AIChatboxContent (Main Chat Component)
  â”‚   â”‚
  â”‚   â”œâ”€ State:
  â”‚   â”‚  â”œâ”€ messages: Message[]
  â”‚   â”‚  â”œâ”€ userInput: string
  â”‚   â”‚  â”œâ”€ selectedModel: string ("openai/gpt-oss-20b:free")
  â”‚   â”‚  â”œâ”€ useOpenRouter: boolean
  â”‚   â”‚  â”œâ”€ isLoading: boolean
  â”‚   â”‚  â””â”€ messagesContainerRef: RefObject
  â”‚   â”‚
  â”‚   â”œâ”€ Effects:
  â”‚   â”‚  â”œâ”€ Load from localStorage on mount
  â”‚   â”‚  â”œâ”€ Save to localStorage on message change
  â”‚   â”‚  â””â”€ Auto-scroll on message change
  â”‚   â”‚
  â”‚   â”œâ”€ Handlers:
  â”‚   â”‚  â”œâ”€ handleSendMessage()
  â”‚   â”‚  â”‚  â”œâ”€ Detect endpoint (OpenRouter or Gemini)
  â”‚   â”‚  â”‚  â”œâ”€ Format request body
  â”‚   â”‚  â”‚  â”œâ”€ POST to correct endpoint
  â”‚   â”‚  â”‚  â””â”€ Process response
  â”‚   â”‚  â”‚
  â”‚   â”‚  â”œâ”€ extractAndDispatchData()
  â”‚   â”‚  â”‚  â””â”€ dispatch(change*Action(...))
  â”‚   â”‚  â”‚
  â”‚   â”‚  â””â”€ Clear All Handler
  â”‚   â”‚     â”œâ”€ setMessages([])
  â”‚   â”‚     â”œâ”€ localStorage.removeItem()
  â”‚   â”‚     â””â”€ dispatch(setResume(initialResumeState))
  â”‚   â”‚
  â”‚   â””â”€ Render:
  â”‚      â”œâ”€ Header with controls
  â”‚      â”œâ”€ Messages container (with ref)
  â”‚      â””â”€ Input form
  â”‚
  â”œâ”€â†’ ResumeForm (Form Editor)
  â”‚   â”‚
  â”‚   â””â”€ Connected via Redux:
  â”‚      â”œâ”€ useAppSelector(selectResume)
  â”‚      â””â”€ dispatch(change*Action(...))
  â”‚
  â””â”€â†’ Resume (Preview)
      â”‚
      â””â”€ Connected via Redux:
         â””â”€ useAppSelector(selectResume)
```

---

## ğŸ”„ Data Flow Diagram

```
User Input (Chat Message)
    â†“
handleSendMessage()
    â†“
Detect Model Type
â”œâ”€ Starts with "openai/"? â†’ OpenRouter
â””â”€ Otherwise? â†’ Gemini
    â†“
Format Request Body
â”œâ”€ OpenRouter: {messages, model, site_url, site_title}
â””â”€ Gemini: {conversationHistory, userMessage, role, model}
    â†“
POST to /api/openrouter or /api/chat
    â†“
Backend Processing
â”œâ”€ OpenRouter path:
â”‚  â”œâ”€ OpenAIRTClient.send_message()
â”‚  â”œâ”€ Call OpenRouter API
â”‚  â””â”€ Extract resume data
â”‚
â””â”€ Gemini path:
   â”œâ”€ GeminiClient.send_message()
   â”œâ”€ Call Google Gemini API
   â””â”€ Extract resume data
    â†“
Response: {assistantMessage, resumeData}
    â†“
Frontend Processing
â”œâ”€ Add message to state
â”œâ”€ Auto-scroll to latest
â”œâ”€ Extract resume data
â”œâ”€ Dispatch Redux action
â””â”€ Save to localStorage
    â†“
UI Update
â”œâ”€ Chat message appears
â”œâ”€ Form fields auto-fill
â”œâ”€ Resume preview updates
â””â”€ All data persists
```

---

## ğŸš€ Deployment Architecture

```
Development
â”œâ”€ Frontend: localhost:3000
â”œâ”€ Backend: localhost:8000
â””â”€ localStorage: Browser storage

Production
â”œâ”€ Frontend: deployed to Vercel/AWS/etc
â”œâ”€ Backend: deployed to Heroku/AWS/Azure/etc
â”œâ”€ Environment Variables:
â”‚  â”œâ”€ Frontend: NEXT_PUBLIC_GEMINI_API_URL
â”‚  â””â”€ Backend: OPENROUTER_API_KEY, GEMINI_API_KEY
â””â”€ localStorage: Browser storage (same)
```

---

**Architecture Status**: âœ… Complete and Verified
**Components Integrated**: 5/5 âœ…
**Data Flow**: Optimized âœ…
**Production Ready**: Yes âœ…
